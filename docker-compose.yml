services:
  agent:
    build:
      context: ./agent
    ports:
      - "8123:8123"
    # Optional: set Jira/Anthropic/etc env vars here or in your shell.
    # (We don't reference ./agent/.env directly because compose fails if it doesn't exist.)
    environment:
      # Helps file watching in bind mounts on some hosts
      - PYTHONUNBUFFERED=1
    volumes:
      # Hot-reload agent code/config
      - ./agent:/app
      # Keep venv inside a named volume (so bind-mount doesn't wipe it)
      - agent_venv:/app/.venv
      - agent_uv_cache:/root/.cache/uv

  ui:
    build:
      context: .
    ports:
      - "3000:3000"
    stdin_open: true
    tty: true
    depends_on:
      - agent
    environment:
      # IMPORTANT: inside compose, "localhost" would be the ui container.
      - LANGGRAPH_DEPLOYMENT_URL=http://agent:8123
      # Helps file watching in bind mounts on macOS/Windows
      - WATCHPACK_POLLING=true
    volumes:
      # Hot-reload UI source
      - ./src:/app/src
      - ./public:/app/public
      # Keep node_modules inside container (avoid bind-mount overwriting it)
      - ui_node_modules:/app/node_modules
      - ui_next_cache:/app/.next

volumes:
  agent_venv:
  agent_uv_cache:
  ui_node_modules:
  ui_next_cache:
